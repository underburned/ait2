# Лабораторная работа №2. Docker

[Лекция: L2. Docker](../lectures/ait2_lec2.ipynb).

## Задание 1

На базе образа [Ubuntu 22.04](https://hub.docker.com/_/ubuntu) создать Docker контейнер со сборкой OpenCV с non free 
contrib модулями (пример 3 из лекции).
- Версия Убунты: 22.04
- OpenCV: 4.8.0
- CUDA: 12.2

1. Отредактировать скрипт сборки [build.sh](ait2_l2/build.sh), заменить значения:
   - `image_tag` - название тега;
   - `build_thread_count` - количество потоков для сборки библиотеки, лучше указать $n - 1$, где $n$ - количество 
   *физических* ядер CPU.
2. C CUDA возможны различные приколы при установке, особенно на старые релизы типа 18.04. Если в системе нет GPU Nvidia,
   то установку CUDA можно вырезать из скрипта сборки и докер файла.
3. Изменить права доступа, выдать разрешение для запуска скриптов `build.sh`, `build_env.sh`:
   ```bash
   chmod +x build.sh
   chmod +x build_env.sh
   ```
4. Дописать в конец докер файла (перед `CMD`) команды для установки необходимых либ Python 3.
5. Запустить `build.sh` для сборки контейнера.
6. Реализовать [алгоритм обработки изображений](data/ait2_l2/sub_task_opencv.md), скрипт на питоне положить в папку на хосте.
7. Запустить контейнер командой:
   ```bash
   docker run -v <путь на хосте>:<путь внутри контейнера> -it <имя тега>
   ```
8. Запустить скрипт с реализованным алгоритмом в контейнере в примонитрованной внутри контейнера папке. 
   Результат обработки сохранить в локальной директории контейнера.
9. Убедиться в появлении результата в директории хоста.

## Задание 2.

Запустить предобученную нейронку с использованием `pytorch` внутри контейнера. Для создания контейнера использовать 
`Docker Compose`.

1. Собрать контейнер с установленным PyTorch (CPU или GPU версия).
  > Проще всего собрать контейнер на базе подготовленного образа с Docker Hub, например, 
    [pytorch:2.1.0-cuda11.8-cudnn8-devel](https://hub.docker.com/layers/pytorch/pytorch/2.1.0-cuda11.8-cudnn8-devel/images/sha256-558b78b9a624969d54af2f13bf03fbad27907dbb6f09973ef4415d6ea24c80d9?context=explore).
    Можно и из обычного образа, например, Убунты. Тогда нужно будет установить CUDA определенной версии 
  при сборке контейнера, а на самом хосте поставить [NVIDIA Container Toolkit](https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html). 
2. Написать [скрипт обработки изображений с использованием нейросети](data/ait2_l2/sub_task_pytorch.md). 
   Можно выбрать любую понравившуюся модель/задачу обработки изображения нейросетью. 
   > У [niconielsen32](https://github.com/niconielsen32) в репах есть целая подборка различных заготовок по 
     [Computer Vision](https://github.com/niconielsen32/ComputerVision), например, 
     [вычисление карты глубин по изображению](https://github.com/niconielsen32/ComputerVision/blob/master/MonocularDepth/midasDepthMap.py).
3. Запустить контейнер командой:
   ```bash
   docker compose -f <имя_конфига.yaml> up
   ```
4. Запустить скрипт с реализованным алгоритмом в контейнере в примонитрованной внутри контейнера папке. 
   Результат обработки сохранить в локальной директории контейнера.
5. Убедиться в появлении результата в директории хоста.